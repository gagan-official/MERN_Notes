# MongoDB üçÉ

A NoSQL database, stores data in JSON format (technically a BSON - Binary JS Object Notation), which should have:

1. **Database** - consist of collections
2. **Collections** (Tables for SQL) - consist of documents
3. **Document** (Single Row for SQL) - consist of Field-value pairs
4. **Field** (Single Column for SQL)

## Mongosh üìü (Shell for MongoDB)

### Creating, Using, Showing and Deleting DB

1. `show dbs`: Shows all databases.

2. `use <db_name>`: Creates a new or enters into existing DB

```sql
use school
```

3.  `db.dropDatabse()`: Drops current Database.

4.  `db.createCollection('students')`: Creates a new Collection (Table)

        More options:
        db.createCollection("teachers", {        capped: true       ,             size: 10000000           ,               max: 100                            }
                                          For limiting size of db       For limiting size of DB in bytes       For limiting no. of Documents in this Collection
                                        }
                           ,
                           { autoIndexId: false||true }
        )

### üìù‚öôÔ∏è Adding, Updating and deleting documents from Collection

1. **Inserting One**: `db.students.insertOne({ name: "gagandeep", age: 25, gpa: 3.2 })`: for insering one document.
2. **Inserting Many**: `db.students.insertMany([{ name: "chintu", age: 21, gpa: 3.4 },{ name: "Kalu", age: 27, gpa: 5.2 }])`: for insering mnay documents at once.

3. **Update One** and **Update Many**: `db.<collection_name>.(updateOne || updateMany)(<filter>, <update>)`: for updating one and selected document respectively:

```js
db.students.updateOne(
  { name: "gagandeep" },
  { $set: { "<new_field> | <existing_field>": "<value>" } }
); // for adding a new or updating an existing field value in document.
db.students.updateOne(
  { name: "gagandeep" },
  { $unset: { "<existing_field>": "<any_data_type>" } }
); // for deleting an existing field from document.
```

```js
db.students.updateMany(
  { fullTime: { $exists: false } },
  { $set: { fullTime: false } }
);
db.students.updateMany({ gpa: 3.4 }, { $unset: { fullTime: "" } }); // will remove fullTime feild from all documents consising of 'gpa' field.
db.users.updateMany(
  { name: "Mukesh" },
  {
    $push: {
      hobbies: "Hiking",
      fav_sports: { $each: ["Football", "Basketball", "Hockey"] },
    },
    $set: { "address.city": "Mumbai" },
  }
); // $push for adding only one element in the array with duplicacy allowed; and $each operator for adding multiple duplicate elements in an array.
db.users.updateMany(
  { name: "Mukesh" },
  {
    $addToSet: {
      hobbies: "Hiking",
      fav_sports: { $each: ["Football", "Basketball", "Hockey"] },
    },
  }
); // $addToSet for adding only one element in the array with NON DUPLICACY check; and $each operator for adding multiple distinct elements in an array.

// Aggregation Pipeline for removing duplicate values from array using $setUnion:
db.users.updateOne({ name: "Mukesh" }, [
  {
    $set: {
      fav_sports: { $setUnion: ["$fav_sports", []] },
      hobbies: { $setUnion: ["$hobbies", []] },
    },
  },
]);
```

4. **Delete One** and **Delete Many**: `db.<collection_name>.(deleteOne || deleteMany)(<filter>)`: for deleting one or all selected documents:

```js
db.students.deleteOne({ fullTime: { $exists: false } }); // will delete only first occurance.
db.students.deleteMany({ fullTime: { $exists: true }, gpa: 3.4 });
db.users.deleteMany({ name: { $in: ["Jhandu", "Mukesh"] } }); // To delete many docs at once with different values, can use "$in" operator
db.users.deleteMany({ "address.street": "Laxmi Nagar" }); // To delete all docs with nested objects filtering using DOT notation.
```

### üßæüîç Reading A Collection

1. **SELECT**: `db.students.find()` || `db["students"].find()`: Selects and shows all documents in a specific collection (shows a table).

   1.1. **Select \* from table where column=value**: `db.students.find({ name: "Gagandeep" })`: Will return all documents where name field is "Gagandeep".

   1.2. **Select column from table where column=value**: `db.students.find({ age: 25 }, { name: true | 1 })`: Will return all documents consisiting only name field where age field is 25.

   Output: `[ { _id: ObjectId('69034a4763ba884a50ce5f49'), name: 'Kalu' } ]`

   We can do this thing:
   `db.students.find({ age: 25 }, { _id: false, name: true | 1 })`

   Output: `[ { name: 'Kalu' } ]`

`.find()` method:

```js
db.students.find({ <query> }, { <projection> })
```

2. **Sorting**: `db.<collection_name>.find().sort({ <fieldName>: 1 | -1 })`: Selects and shows all documents in a specific collection and sorted on basis of single or multiple specific fields, by default all docs are sorted by id generated by mongoDB:

```js
db.students.find().sort({ gpa: 1 }); // +1 for Increasing order

db.students.find().sort({ gpa: -1 }); // -1 for Decreasing order
```

3. **Limiting**: `db.<collection_name>.find().limit(<number>)`: for getting limited documents:

```js
db.students.find().sort({ gpa: -1 }).limit(1); // for selecting a student on the basis of highest GPA they got.
```

## Operators ‚öôÔ∏è

### Comparison Query Operators:

1. **$set** - Atomic operator for setting a feild.
2. **$unset** - Atomic operator for removing a feild.
3. **$exists** - Operator for checking if a feild exists or not.
4. **$ne** - _Not equal to_ (!=) Operator.
5. **$lt** - _Less than_ (<) Operator.
6. **$lte** - _Less than equal to_ (<=) Operator.
7. **$gt** - _Greater than_ (>) Operator.
8. **$gte** - _Greater than equal to_ (>=) Operator.
9. **$in** - Can be passed Array of values for matching with any document within the collection using **$in** Operator:

```js
db.students.find({ name: { $in: ["Spongebob", "Patrick", "Sandy"] } });
```

10. **$nin** - Can be passed Array of values for getting all the documents except the values provided in the Array list using **$nin** Operator:

```js
db.students.find({ name: { $nin: ["Spongebob", "Patrick", "Sandy"] } });
```

> **Note:** Many of the comparison operators can be used **together** for finding a range:

```js
db.students.find({ gpa: { $gte: 3, $lte: 4 } });
```

### Logical Query Operators

1. **$not** - NOT operator `db.students.find({ age: { $not: { $gte: 30 } } })` able to return null values as well if we want, which wasn't possible in the query: `db.students.find({ age: { $lt: 30 } })`
2. **$and** - AND operator `db.students.find({ $and: [ {fullTime: true}, { age: { $lte: 22 } } ] })`
3. **$or** - OR operator `db.students.find({ $or: [ {fullTime: true}, { age: { $lte: 22 } } ] })`
4. **$nor** - !AND operator (This works as **negate AND** operator as to search all docs except the conditions passed in the filter) `db.students.find({ $nor: [ {fullTime: true}, { age: { $lte: 22 } } ] })`

> But the nor is the exact inverse (not opposite) of the OR gate as the OR condition:

      **OR:**
      if(Any or all of the conditions are TRUE) return TRUE;
      else (implicitly means all conditions were FALSE) return FALSE;

      **NOR:**
      if(Any or all of the conditions are TRUE) return !TRUE = FALSE;
      else (implicitly means all conditions were FALSE) return !FALSE = TRUE;

      Means NOR is now chasing for else part which can also be written in IF part (inverted):

      if(All conditions are FALSE) return TRUE;
      else (implicitly means Any or all of the conditions were TRUE) return FALSE;

## Indexing ‚òùÔ∏è

Used for fast searching using Binary Search in B-Trees:

`db.students.find({ name: "gagandeep" }).explain("executionStats")` // With fonud docs, Will show "whole collection traversed" also for finding the searched doc.

`db.students.createIndex({ name: 1 || -1 })`

"1" is used for sorting data in Ascending Order while "-1" is used for sorting data in Descending Order.

`db.students.find({ name: "gagandeep" }).explain("executionStats")` // After indexing, With fonud docs, Will show "only limited collection traversed" also for finding the searched doc.

### To get indexes:

`db.students.getIndexes()` // Gets all the indexes at current collection:

Output:

```js
[
  { v: 2, key: { _id: 1 }, name: "_id_" },
  { v: 2, key: { name: 1 }, name: "name_1" },
];
```

### Can drop Index as well:

`db.students.dropIndex("name_1")`

## Mongoose (An Open-Source ODM using the official "MongoDB Node.js Driver" under the hood) [Go to Notes File üîó](./Mongoose%20üêÄ.md)

1. Schema
2. Model
3. Query
